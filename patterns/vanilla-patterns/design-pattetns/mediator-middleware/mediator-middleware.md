## Оглавление

- [Mediator/Middleware паттерн](#mediator-middleware-паттерн)
  - [Пример использования](#пример-использования)
- [Express.js ](#express-js)

# Mediator-Middleware паттерн

**Шаблон «Медиатор»** позволяет компонентам взаимодействовать друг с другом **через центральную точку: посредника**. Вместо того, чтобы напрямую взаимодействовать друг с другом, посредник получает запросы и передаёт их дальше! В JavaScript посредник часто представляет собой не более чем литерал объекта или функцию.

> Эту схему можно сравнить с отношениями между авиадиспетчером и пилотом.

## Пример использования

Хороший пример использования шаблона «Посредник» — чат! Пользователи в чате не будут общаться друг с другом напрямую. Вместо этого чат выступает в роли посредника между пользователями.

```js
class ChatRoom {
	logMessage(user, message) {
		const time = new Date();
		const sender = user.getName();

		console.log(`${time} [${sender}]: ${message}`);
	}
}

class User {
	constructor(name, chatroom) {
		this.name = name;
		this.chatroom = chatroom;
	}

	getName() {
		return this.name;
	}

	send(message) {
		this.chatroom.logMessage(this, message);
	}
}
```

Мы можем создавать новых пользователей, подключенных к чату. У каждого пользователя есть **send** метод, который можно использовать для отправки сообщений.

[Пример реализации](https://codesandbox.io/embed/late-glade-7gjmr).

## Express js

**Express.js** — популярный фреймворк для серверов веб-приложений. Мы можем добавлять обратные вызовы к определённым маршрутам, к которым пользователь имеет доступ

Допустим, мы хотим добавить заголовок к запросу, если пользователь обращается к корню '/'. Мы можем добавить этот заголовок в обратный вызов промежуточного программного обеспечения.

```js
const app = require('express')();

app.use('/', (req, res, next) => {
	req.headers['test-header'] = 1234;
	next();
});
```

Метод **next** вызывает следующий обратный вызов в цикле «запрос-ответ».

_Фактически, мы создаём цепочку промежуточных функций, расположенных между запросом и ответом, и наоборот_.

[Пример реализации](https://codesandbox.io/embed/late-glade-7gjmr).

Давайте добавим ещё одну промежуточную функцию, которая проверит test-headerправильность добавления.

```js
//...код
//app.use(...,
(req, res, next) => {
	console.log(`Request has test header: ${!!req.headers['test-header']}`);
	next();
};
//)
```

[Пример реализации](https://codesandbox.io/p/sandbox/express-js-0e4yr?embed=1).

Каждый раз, когда пользователь обращается к корневой конечной точке '/', будут вызываться два обратных вызова промежуточного программного обеспечения.

<hr>
