## Оглавление

- [Observer паттерн](#observer-паттерн)
  - [Пример использования](#пример-использования)
- [Плюсы использования Observer](#плюсы-использования-observer)

# Observer паттерн

**Шаблон наблюдателя** — мы можем подписать определённые объекты (**наблюдатели**) на другой объект, называемый **наблюдаемым**. Всякий раз, когда происходит событие, наблюдаемый уведомляет всех своих наблюдателей!

_Наблюдаемый объект обычно состоит из 3 важных частей:_

- **observers**: массив наблюдателей, которые будут получать уведомления всякий раз, когда происходит определенное событие;
- **subscribe()**: метод добавления наблюдателей в список наблюдателей;
- **unsubscribe()**: метод удаления наблюдателей из списка наблюдателей;
- **notify()**: метод оповещения всех наблюдателей о каждом конкретном событии.

## Пример использования

```js
class Observable {
	constructor() {
		this.observers = [];
	}

	subscribe(func) {
		this.observers.push(func);
	}

	unsubscribe(func) {
		this.observers = this.observers.filter((observer) => observer !== func);
	}

	notify(data) {
		this.observers.forEach((observer) => observer(data));
	}
}
```

Отлично! Теперь мы можем **добавлять** наблюдателей в список наблюдателей с помощью метода _subscribe_, **удалять наблюдателей** с помощью метода _unsubscribe_ и **уведомлять** всех подписчиков с помощью метода _notify_.

```jsx
export default function App() {
	return (
		<div className="App">
			<Button>Click me!</Button>
			<FormControlLabel control={<Switch />} />
		</div>
	);
}
```

Мы хотим отслеживать **взаимодействие пользователя** с приложением. Каждый раз, когда пользователь _нажимает_ кнопку или _переключает_ переключатель, мы хотим регистрировать это событие с меткой времени. Помимо регистрации, мы также хотим создать всплывающее уведомление, которое будет появляться при каждом возникновении события!

Каждый раз, когда пользователь вызывает функцию _handleClick_ or _handleToggle_, функции вызывают _notify_ метод на наблюдателе. Этот _notify_ метод уведомляет всех подписчиков данными, переданными функцией _handleClick_ or _handleToggle_!

Сначала создадим функции _logger_ и _toastify_. Эти функции в конечном итоге будут получать данные _data_ из _notify_ метода.

```jsx
import { ToastContainer, toast } from 'react-toastify';

function logger(data) {
	console.log(`${Date.now()} ${data}`);
}

function toastify(data) {
	toast(data);
}

export default function App() {
	return (
		<div className="App">
			<Button>Click me!</Button>
			<FormControlLabel control={<Switch />} />
			<ToastContainer />
		</div>
	);
}
```

В настоящее время функции _logger_ и _toastify_ не знают о **наблюдаемых**: наблюдаемые пока не могут их уведомить! Чтобы сделать их наблюдателями, нам придётся подписать их, используя _subscribe_ метод наблюдаемого!

```js
// ...
observable.subscribe(logger);
observable.subscribe(toastify);
// export default ...
```

При каждом возникновении события функции _logger_ и _toastify_ будут получать уведомления.
Теперь осталось только реализовать функции, которые фактически уведомляют наблюдаемый объект: функции _handleClick_ и _handleToggle_! Эти функции должны вызывать _notify_ метод наблюдаемого объекта и передавать данные, которые должны получить наблюдатели.

```jsx
//...
//export default App() {
function handleClick() {
	observable.notify('User clicked button!');
}

function handleToggle() {
	observable.notify('User toggled switch!');
}
// остальной код
// }
```

_handleClick_ вызываем _handleToggle_ метод _notify_ наблюдателя с данными, после чего наблюдатель уведомляет подписчиков: в данном случае это функции _logger_ и _toastify_

Всякий раз, когда пользователь взаимодействует с любым из компонентов, обе функции _logger_, и _toastify_, будут получать уведомления с данными, которые мы передали методу notify!

[Пример реализации паттерна](https://codesandbox.io/embed/quizzical-sinoussi-md8k5).

## Плюсы использования Observer

Хотя шаблон **«Наблюдатель»** можно использовать по-разному, он особенно **полезен при работе с асинхронными данными, основанными на событиях**. Возможно, вам нужно, чтобы определённые компоненты получали уведомления о завершении загрузки определённых данных или о новых сообщениях пользователей на форуме, а все остальные участники получали уведомления.

Популярная библиотека, использующая шаблон observable, — **RxJS**.
[Пример реализации библиотеки](https://codesandbox.io/embed/stoic-turing-kqq9z).
