## Оглавление

- [Proxy паттерн](#proxy-паттерн)
  - [Пример использования](#пример-использования)
  - [Плюсы использования Proxy](#плюсы-использования-proxy)
  - [Reflect](#reflect)
  - [Компромиссы](#компромиссы)

# Proxy паттерн

> С помощью прокси-объекта мы получаем больше контроля над взаимодействием с определенными объектами. Прокси-объект может определять поведение при каждом взаимодействии с объектом, например, при получении или установке значения.

> В общем случае прокси-сервер заменяет кого-то другого. Вместо того, чтобы обращаться к этому человеку напрямую, вы обращаетесь к прокси-серверу, который представляет того человека, с которым вы пытались связаться. То же самое происходит и в JavaScript: вместо прямого взаимодействия с целевым объектом мы взаимодействуем с прокси-объектом.

## Пример использования

\*Создадим объект **person\***

Вместо прямого взаимодействия с этим объектом мы хотим взаимодействовать с прокси-объектом. В JavaScript мы можем легко создать новый прокси, создав новый экземпляр Proxy.

```js
const person = {
	name: 'John Doe',
	age: 42,
	nationality: 'American'
};

const personProxy = new Proxy(person, {});
```

Вторым аргументом _Proxy_ является **объект**, представляющий _обработчик_. В объекте обработчика **можно определить определённое поведение в зависимости от типа взаимодействия**. Хотя существует множество методов , которые можно добавить к обработчику Proxy, **два наиболее распространённых — это get и set**

- get: Вызывается при попытке доступа к свойству.
- set: Вызывается при попытке изменить свойство.

Вместо того чтобы взаимодействовать с _person_ объектом напрямую, мы будем взаимодействовать с **personProxy**.

Давайте добавим обработчики в _personProxy_ прокси-сервер. При попытке изменить свойство, вызывая _set_ метод на Proxy, мы хотим, чтобы прокси-сервер регистрировал предыдущее и новое значения свойства. При попытке доступа к свойству, вызывая метод _get_ на Proxy, мы хотим, чтобы прокси-сервер регистрировал более читабельное предложение, содержащее ключ и значение свойства.

```js
const personProxy = new Proxy(person, {
	get: (obj, prop) => {
		console.log(`The value of ${prop} is ${obj[prop]}`);
	},
	set: (obj, prop, value) => {
		console.log(`Changed ${prop} from ${obj[prop]} to ${value}`);
		obj[prop] = value;
	}
});
```

## Плюсы использования Proxy

Прокси-сервер может быть полезен для добавления **проверки**.

Пользователь не должен иметь возможности изменить _person_ возраст объекта на строковое значение или задать пустое имя. Если пользователь пытается получить доступ к свойству несуществующего объекта, необходимо сообщить ему об этом.

```js
const personProxy = new Proxy(person, {
	get: (obj, prop) => {
		if (!obj[prop]) {
			console.log(`Hmm.. this property doesn't seem to exist on the target object`);
		} else {
			console.log(`The value of ${prop} is ${obj[prop]}`);
		}
	},
	set: (obj, prop, value) => {
		if (prop === 'age' && typeof value !== 'number') {
			console.log(`Sorry, you can only pass numeric values for age.`);
		} else if (prop === 'name' && value.length < 2) {
			console.log(`You need to provide a valid name.`);
		} else {
			console.log(`Changed ${prop} from ${obj[prop]} to ${value}.`);
			obj[prop] = value;
		}
	}
});
```

## Reflect

JavaScript предоставляет встроенный объект **Reflect**, называемый, который упрощает манипулирование целевым объектом при работе с прокси.

Ранее мы пытались изменять и получать доступ к свойствам целевого объекта внутри прокси-сервера, напрямую получая или устанавливая значения с помощью квадратных скобок. Вместо этого мы можем использовать объект Reflect. Методы объекта **Reflect** имеют те же имена, что и методы объекта **handler**.

Вместо доступа к свойствам через **obj[prop]** или установки свойств через **obj[prop] = value**, мы можем получать доступ к свойствам целевого объекта или изменять их через **Reflect.get()** и **Reflect.set()**. Методы получают те же аргументы, что и методы объекта-обработчика.

```js
const personProxy = new Proxy(person, {
	get: (obj, prop) => {
		console.log(`The value of ${prop} is ${Reflect.get(obj, prop)}`);
	},
	set: (obj, prop, value) => {
		console.log(`Changed ${prop} from ${obj[prop]} to ${value}`);
		Reflect.set(obj, prop, value);
	}
});
```

## Компромиссы

**Прокси-серверы** — это мощный способ управления поведением объекта.

> Прокси-сервер может использоваться в различных целях: он может использоваться для проверки, форматирования, уведомлений или отладки.

Чрезмерное использование _Proxy_ объекта или выполнение ресурсоёмких операций при каждом _handler_ вызове метода может легко негативно сказаться на производительности вашего приложения.

> Лучше не использовать прокси-объекты для кода, критически важного для производительности.
